# ELFI è‡ªä¸¾æµ‹è¯•æ–‡æ¡£
# ç”¨äºéªŒè¯ elfi å¯ä»¥ç®¡ç†å…¶è‡ªèº«çš„ Rust æºä»£ç 

---
id: a0b1c2d3-4e5f-6789-abcd-ef0123456789
type: metadata
name: document-meta
metadata:
  title: "ELFI Development Bootstrapping"
  version: "1.0"
  created: "2024-01-15"
  purpose: "Self-hosting test case for elfi development"
---

---
id: b1c2d3e4-5f67-89ab-cdef-0123456789ab
type: code
name: dev-block-rust
metadata:
  language: rust
  description: "æ ¸å¿ƒçš„ Rust ä»£ç ï¼Œç”¨äºéªŒè¯è‡ªä¸¾èƒ½åŠ›"
  tags: ["rust", "core", "bootstrap"]
  export_path: "src/bootstrapped_code.rs"
  owner: "dev-team"
---
// ELFI bootstrapped code module
// This code is managed and exported from elfi-dev.elf

use std::collections::HashMap;
use serde::{Deserialize, Serialize};

/// æ–‡æ¡£æ“ä½œå†å²çš„æ ¸å¿ƒæ•°æ®ç»“æ„
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct OperationLog {
    pub id: String,
    pub timestamp: u64,
    pub author: String,
    pub operation_type: String,
    pub content: String,
}

/// ç®€å•çš„å†…å­˜ä¸­æ“ä½œå†å²ç®¡ç†å™¨
pub struct HistoryManager {
    operations: Vec<OperationLog>,
    index: HashMap<String, usize>,
}

impl HistoryManager {
    /// åˆ›å»ºæ–°çš„å†å²ç®¡ç†å™¨å®ä¾‹
    pub fn new() -> Self {
        Self {
            operations: Vec::new(),
            index: HashMap::new(),
        }
    }
    
    /// æ·»åŠ æ–°çš„æ“ä½œè®°å½•
    pub fn add_operation(&mut self, op: OperationLog) {
        let position = self.operations.len();
        self.index.insert(op.id.clone(), position);
        self.operations.push(op);
        // This is a test comment.
    }
    
    /// æ ¹æ®IDè·å–æ“ä½œè®°å½•
    pub fn get_operation(&self, id: &str) -> Option<&OperationLog> {
        self.index.get(id)
            .and_then(|&idx| self.operations.get(idx))
    }
    
    /// è·å–æ‰€æœ‰æ“ä½œå†å²
    pub fn get_all_operations(&self) -> &[OperationLog] {
        &self.operations
    }
}

impl Default for HistoryManager {
    fn default() -> Self {
        Self::new()
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_history_manager_basic_operations() {
        let mut manager = HistoryManager::new();
        
        let op = OperationLog {
            id: "test-op-001".to_string(),
            timestamp: 1705123200,
            author: "test-user".to_string(),
            operation_type: "create_block".to_string(),
            content: "Test content".to_string(),
        };
        
        manager.add_operation(op.clone());
        
        let retrieved = manager.get_operation("test-op-001");
        assert!(retrieved.is_some());
        assert_eq!(retrieved.unwrap().content, "Test content");
        
        assert_eq!(manager.get_all_operations().len(), 1);
    }
}

---
id: c2d3e4f5-6789-abcd-ef01-23456789abcd
type: recipe
name: code-export-recipe
metadata:
  description: "ç”¨äºå¯¼å‡º Rust ä»£ç åŒºå—çš„Recipeé…ç½®"
  tags: ["recipe", "export", "rust"]
---
name: code-export-recipe
version: "1.0"
description: "å¯¼å‡º Rust ä»£ç åŒºå—åˆ°æ–‡ä»¶ç³»ç»Ÿ"

# é€‰æ‹©å™¨ï¼šåªå¤„ç† code ç±»å‹çš„åŒºå—
selector:
  types: ["code"]
  names: ["dev-block-rust"]
  metadata:
    language: "rust"

# è½¬æ¢è§„åˆ™ï¼šä¿æŒåŸæœ‰æ ¼å¼
transform:
  - type: "code"
    action: "copy"
    preserve_format: true
    add_header: |
      // This file was automatically generated from elfi-dev.elf
      // Do not edit directly - make changes in the .elf file instead

# è¾“å‡ºé…ç½®
output:
  format: "file-per-block"
  base_path: "src/"
  filename_mapping:
    "dev-block-rust": "bootstrapped_code.rs"
  create_directories: true

---
id: d3e4f567-89ab-cdef-0123-456789abcdef
type: markdown
name: test-documentation
metadata:
  description: "è‡ªä¸¾æµ‹è¯•çš„è¯´æ˜æ–‡æ¡£"
  tags: ["documentation", "test"]
---
# è‡ªä¸¾æµ‹è¯•è¯´æ˜

è¿™ä¸ªæ–‡æ¡£ç”¨äºéªŒè¯ `elfi` çš„è‡ªä¸¾èƒ½åŠ›ï¼Œå³ç”¨ `elfi` æœ¬èº«æ¥ç®¡ç† `elfi` çš„æºä»£ç ã€‚

## æµ‹è¯•ç›®æ ‡

1. **ä»£ç ç®¡ç†**: åœ¨ `.elf` æ–‡ä»¶ä¸­ç»´æŠ¤ Rust æºä»£ç 
2. **Recipeå¯¼å‡º**: ä½¿ç”¨ Recipe ç³»ç»Ÿå°†ä»£ç å¯¼å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿ
3. **ç¼–è¯‘éªŒè¯**: ç¡®ä¿å¯¼å‡ºçš„ä»£ç èƒ½å¤Ÿæ­£å¸¸ç¼–è¯‘å’Œæµ‹è¯•
4. **åŒå‘åŒæ­¥**: éªŒè¯ IDE ä¸­çš„ä¿®æ”¹èƒ½å¤ŸåŒæ­¥å› `.elf` æ–‡ä»¶

## å½“å‰çŠ¶æ€

- âœ… åˆ›å»ºäº†åŒ…å«çœŸå® Rust ä»£ç çš„ `dev-block-rust` åŒºå—
- âœ… é…ç½®äº† `code-export-recipe` Recipe ç”¨äºä»£ç å¯¼å‡º
- ğŸ”„ ç­‰å¾…æµ‹è¯•æ‰§è¡Œå’ŒéªŒè¯

## ä½¿ç”¨æ–¹å¼

```bash
# å¯¼å‡ºä»£ç åˆ°æ–‡ä»¶ç³»ç»Ÿ
elfi export --recipe code-export-recipe ./src/

# éªŒè¯ç¼–è¯‘
cargo test

# å¯åŠ¨åŒå‘åŒæ­¥ï¼ˆå¯é€‰ï¼‰
elfi watch --project elfi-dev --export-dir ./src/
```

---
id: e4f56789-abcd-ef01-2345-6789abcdef01
type: markdown
name: changelog
metadata:
  description: "æµ‹è¯•è¿‡ç¨‹ä¸­çš„å˜æ›´æ—¥å¿—"
  tags: ["changelog", "test"]
  parent: d3e4f567-89ab-cdef-0123-456789abcdef
---
# å˜æ›´æ—¥å¿—

è®°å½•è‡ªä¸¾æµ‹è¯•è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¿®æ”¹å’Œè§‚å¯Ÿï¼š

## 2024-01-15

- **åˆå§‹åˆ›å»º**: åˆ›å»ºäº† `elfi-dev.elf` æµ‹è¯•æ–‡æ¡£
- **ä»£ç åŒºå—**: æ·»åŠ äº†åŒ…å« `HistoryManager` å®ç°çš„ Rust ä»£ç 
- **Recipeé…ç½®**: é…ç½®äº†ä»£ç å¯¼å‡ºçš„ Recipe è§„åˆ™
- **æµ‹è¯•æ³¨é‡Š**: åœ¨ `add_operation` æ–¹æ³•ä¸­æ·»åŠ äº†æµ‹è¯•æ³¨é‡Š
- **æ ¼å¼ä¿®æ­£**: ä¿®æ­£äº†åŒºå—åˆ†éš”ç¬¦ï¼Œä½¿ç”¨æ ‡å‡† UUID æ ¼å¼

## å¾…å®Œæˆé¡¹ç›®

- [ ] æ‰§è¡Œ Recipe å¯¼å‡ºæµ‹è¯•
- [ ] éªŒè¯ç”Ÿæˆçš„ `src/bootstrapped_code.rs` æ–‡ä»¶
- [ ] è¿è¡Œ `cargo test` éªŒè¯ç¼–è¯‘
- [ ] æµ‹è¯•åŒå‘åŒæ­¥åŠŸèƒ½
- [ ] è®°å½•æ€§èƒ½å’Œç¨³å®šæ€§è§‚å¯Ÿ