# æµ‹è¯•åœºæ™¯ 01: è‡ªä¸¾ (Bootstrapping)

æœ¬æµ‹è¯•æ—¨åœ¨éªŒè¯ `elfi` çš„æ ¸å¿ƒå¼€å‘å¾ªç¯æ˜¯å¦å¯ä»¥åŸºäº `.elf` æ–‡ä»¶æœ¬èº«è¿›è¡Œã€‚

- **æ ¸å¿ƒç›®æ ‡**: è¯æ˜ `elfi` å¯ä»¥å¯é åœ°ç®¡ç†å’Œå¤„ç†å…¶è‡ªèº«çš„ Rust æºä»£ç ï¼Œå®ç°"ç”¨ `elfi` å¼€å‘ `elfi`"ã€‚

## ğŸ“ å…³è”çš„æµ‹è¯•æ–‡ä»¶

**[elfi-dev.elf](./elfi-dev.elf)** - è‡ªä¸¾æµ‹è¯•çš„å®Œæ•´ `.elf` æ–‡æ¡£

è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æœ¬æµ‹è¯•åœºæ™¯çš„æ‰€æœ‰å¿…è¦ç»„ä»¶ï¼š
- `dev-block-rust`: åŒ…å«çœŸå® Rust æºä»£ç çš„åŒºå—
- `code-export-recipe`: Recipe é…ç½®ï¼Œç”¨äºå¯¼å‡ºä»£ç åˆ°æ–‡ä»¶ç³»ç»Ÿ  
- `test-documentation`: æµ‹è¯•è¯´æ˜å’Œè¿›åº¦è¿½è¸ª
- `changelog`: è¯¦ç»†çš„å˜æ›´è®°å½•

## å…³è”çš„å®ç°æ–‡æ¡£

- `implementations/02-core_logic.md`: æ¶‰åŠæ–‡æ¡£çŠ¶æ€çš„ç®¡ç†ã€‚
- `implementations/03-cli.md`: æ¶‰åŠ `export` å‘½ä»¤å’Œ Recipe ç³»ç»Ÿï¼Œç”¨äºå°†ä»£ç åŒºå—å†…å®¹æå–åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚
- `implementations/04-recipe_system.md`: Recipe ç³»ç»Ÿçš„è¯¦ç»†è®¾è®¡å’Œå®ç°ã€‚

## æµ‹è¯•æµç¨‹è®¾è®¡

1.  **å‡†å¤‡ (Preparation)**
    -   åˆ›å»ºä¸€ä¸ªåä¸º `elfi-dev.elf` çš„æµ‹è¯•æ–‡ä»¶ã€‚
    -   åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä»¥ä¸‹åŒºå—ï¼š
        -   ä¸€ä¸ª `code` ç±»å‹çš„åŒºå— (ID ä¸º `dev-block-rust`)ï¼ŒåŒ…å«çœŸå®çš„ Rust æºä»£ç 
        -   ä¸€ä¸ª `recipe` ç±»å‹çš„åŒºå— (ID ä¸º `code-export-recipe`)ï¼Œç”¨äºå®šä¹‰ä»£ç å¯¼å‡ºè§„åˆ™
    -   åœ¨ `elfi` é¡¹ç›®çš„ `src/` ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ `src/bootstrapped_code.rs`ï¼Œå¹¶åœ¨ `lib.rs` ä¸­é€šè¿‡ `mod bootstrapped_code;` å¼•å…¥ã€‚

2.  **æ‰§è¡Œ (Execution)**
    -   é€šè¿‡ä¸€ä¸ªæ¨¡æ‹Ÿçš„å®¢æˆ·ç«¯æˆ–æµ‹è¯•è„šæœ¬ï¼Œå¯¹ `elfi-dev.elf` æ–‡ä»¶ä¸­çš„ `dev-block-rust` åŒºå—è¿›è¡Œä¸€æ¬¡ç®€å•çš„ç¼–è¾‘ã€‚ä¾‹å¦‚ï¼Œåœ¨å‡½æ•°ä¸­å¢åŠ ä¸€è¡Œæ³¨é‡Š `// This is a test comment.`ã€‚
    -   ä½¿ç”¨ Recipe ç³»ç»Ÿå¯¼å‡ºä»£ç å—åˆ°æ–‡ä»¶ç³»ç»Ÿï¼š
        ```bash
        # ä½¿ç”¨è‡ªå®šä¹‰çš„code-export Recipeå¯¼å‡ºä»£ç 
        elfi export --recipe=code-export-recipe ./src/
        ```
        è¿™ä¸ªRecipeé…ç½®å°†ä¼šï¼š
        - é€‰æ‹© `code` ç±»å‹çš„åŒºå—
        - å°†å†…å®¹å¯¼å‡ºä¸º `src/bootstrapped_code.rs` æ–‡ä»¶
        - ä¿æŒåŸæœ‰çš„ Rust ä»£ç æ ¼å¼

3.  **éªŒè¯ (Verification)**
    -   æ£€æŸ¥ `src/bootstrapped_code.rs` æ–‡ä»¶çš„å†…å®¹ï¼Œç¡®è®¤å®ƒå·²ç»è¢«æ›´æ–°ï¼Œå¹¶ä¸”åŒ…å«äº†ç¬¬äºŒæ­¥ä¸­å¢åŠ çš„æ³¨é‡Šã€‚
    -   éªŒè¯Recipeç³»ç»Ÿçš„æ­£ç¡®æ€§ï¼šæ£€æŸ¥å¯¼å‡ºçš„æ–‡ä»¶ä¸ `.elf` æ–‡ä»¶ä¸­çš„åŒºå—å†…å®¹å®Œå…¨ä¸€è‡´ã€‚
    -   åœ¨ `elfi` é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š
        ```bash
        cargo test
        ```
    -   å¯é€‰éªŒè¯ï¼šä½¿ç”¨ `elfi watch` å‘½ä»¤å¯åŠ¨åŒå‘åŒæ­¥ï¼ŒéªŒè¯åœ¨ IDE ä¸­ä¿®æ”¹ `src/bootstrapped_code.rs` åï¼Œæ›´æ”¹èƒ½å¤Ÿè‡ªåŠ¨åŒæ­¥å› `.elf` æ–‡ä»¶ã€‚

## æˆåŠŸæ ‡å‡†

-   `src/bootstrapped_code.rs` æ–‡ä»¶çš„å†…å®¹ä¸ `.elf` æ–‡ä»¶ä¸­ä»£ç åŒºå—çš„æœ€æ–°å†…å®¹å®Œå…¨ä¸€è‡´ã€‚
-   Recipe ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®è§£æå’Œå¯¼å‡ºä»£ç åŒºå—ï¼Œä¿æŒæ ¼å¼å’Œç»“æ„ã€‚
-   `cargo test` å‘½ä»¤æˆåŠŸé€šè¿‡ï¼Œæ²¡æœ‰ä»»ä½•ç¼–è¯‘é”™è¯¯æˆ–æµ‹è¯•å¤±è´¥ã€‚è¿™è¯æ˜äº†ä» `.elf` æ–‡ä»¶ä¸­æå–å¹¶é›†æˆåˆ°é¡¹ç›®ä¸­çš„ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚
-   æ•´ä¸ªå¼€å‘ -> Recipeå¯¼å‡º -> ç¼–è¯‘çš„æµç¨‹è¯æ˜æ˜¯å¯é çš„ï¼ŒéªŒè¯äº† "**ç”¨ elfi å¼€å‘ elfi**" çš„æ ¸å¿ƒç›®æ ‡ã€‚
-   å¯é€‰ï¼šåŒå‘åŒæ­¥æœºåˆ¶ (`elfi watch`) æ­£å¸¸å·¥ä½œï¼Œå…è®¸åœ¨ä¼ ç»Ÿ IDE ä¸­ç¼–è¾‘å¹¶è‡ªåŠ¨åŒæ­¥å› `.elf` æ–‡ä»¶ã€‚

## Recipe é…ç½®ç¤ºä¾‹

ä¸ºäº†å®ç°ä¸Šè¿°æµ‹è¯•ï¼Œ`code-export-recipe` åŒºå—çš„å†…å®¹åº”è¯¥åŒ…å«ç±»ä¼¼ä»¥ä¸‹çš„ YAML é…ç½®ï¼š

```yaml
name: code-export-recipe
version: 1.0
description: å¯¼å‡º Rust ä»£ç åŒºå—åˆ°æ–‡ä»¶ç³»ç»Ÿ

# é€‰æ‹©å™¨ï¼šåªå¤„ç† code ç±»å‹çš„åŒºå—
selector:
  types: [code]
  filters:
    - lang: "rust"

# è½¬æ¢è§„åˆ™ï¼šä¿æŒåŸæœ‰æ ¼å¼
transform:
  - type: code
    action: copy
    preserve_format: true

# è¾“å‡ºé…ç½®
output:
  format: file-per-block
  path_template: "src/{block_name}.rs"
  filename_mapping:
    "dev-block-rust": "bootstrapped_code.rs"
```
